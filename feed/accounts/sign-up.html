<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign up</title>
</head>
<body>
    <script>
        async function createPageFromParams() {
    const params = new URLSearchParams(window.location.search);
    const accountName = params.get('accountName');
    const profilePic = params.get('profilePic'); // URL for profile picture
    const about = params.get('about'); // User's about section
    const channelName = params.get('channelName'); // User's channel name
    //const videos = params.get('videos'); // Comma-separated video URLs

    if (!accountName || !profilePic || !about || !channelName ) {
        console.error('Missing required parameters');
        return;
    }

    const repoOwner = 'Bannania';
    const repoName = 'bannania.github.io';
    const token = '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';
    const path = `feed/users/${accountName}.html`;
    const message = `Create new page for user: ${accountName}`;

    //const videoArray = videos.split(',').map(videoUrl => `<li><a href="${videoUrl}" target="_blank">${videoUrl}</a></li>`).join('');

    const pageContent = `
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>${channelName}'s Channel</title>
            <style>
                body {
                    font-family: Arial, sans-serif;
                    padding: 20px;
                }
                img {
                    width: 150px;
                    height: 150px;
                    border-radius: 50%;
                }
                h1 {
                    color: #333;
                }
                .about-section, .members-section, .videos-section {
                    margin-bottom: 20px;
                }
                .join-button {
                    background-color: #28a745;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    text-align: center;
                    cursor: pointer;
                    font-size: 16px;
                }
                .join-button:hover {
                    background-color: #218838;
                }
            </style>
        </head>
        <body>
            <h1>${channelName}'s Channel</h1>
            <img src="${profilePic}" alt="${accountName}'s profile picture" />
            <div class="about-section">
                <h2>About</h2>
                <p>${about}</p>
            </div>
            <div class="members-section">
                <h2>Members</h2>
                <p>0 members</p>
                <button class="join-button">Join</button>
            </div>
            <div class="videos-section">
                <h2>Videos</h2>
                <ul>
                    This user hasn't uploaded!
                </ul>
            </div>
        </body>
        </html>
    `;

    const base64Content = btoa(unescape(encodeURIComponent(pageContent)));

    const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}`;

    const response = await fetch(url, {
        method: 'PUT',
        headers: {
            'Authorization': `Bearer ${token}`,
            'Accept': 'application/vnd.github.v3+json',
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            message: message,
            content: base64Content
        })
    });

    if (response.ok) {
        console.log(`Page created successfully for ${accountName}`);
    } else {
        console.error(`Error creating page:`, await response.text());
    }
}

createPageFromParams();

    </script>
</body>
</html>
